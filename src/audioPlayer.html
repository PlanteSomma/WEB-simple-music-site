<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Audio Player</title>
    <link rel="stylesheet" href="https://startr.style/style.css" />
  </head>
  <body>
    <audio controls="" id="audioPlayer">Your browser does not support the audio
        element.</audio>
        <div class="emoji">
          <button onclick="playPreviousTrack()">⏮️</button>
          <button id="playPauseButton" onclick="togglePlayPause()">▶️</button>
          <button onclick="playNextTrack()">⏭️</button>
        </div>
        <div id="trackInfo" class="track-info">Click to Play</div>
        <script>
            const audioPlayer = document.getElementById('audioPlayer');
            const playPauseButton = document.getElementById('playPauseButton'); // Reference to the play/pause button
            const trackInfoElement = document.getElementById('trackInfo'); // Reference to the track info display element
            let currentTrack = 0;
        
              const audioFiles = [
                {% for file in fileList %}
                    {
                    path: "{{ file.path }}",
                    title: "{{ file.title }}",
                    artist: "{{ file.artist }}"
                    }{% if not loop.last %},{% endif %}
                {% endfor %}
                ];
        
                function updateTrackInfo(trackIndex) {
                    // Update the displayed track information
                    const track = audioFiles[trackIndex];
                    trackInfoElement.textContent = `Playing "${track.title}" by ${track.artist} (${trackIndex + 1} of ${audioFiles.length})`;
                    console.log(`Now playing: ${track.title} by ${track.artist}`);
                  }
                
                  function loadAndPlayTrack(trackIndex) {
                    if (trackIndex >= 0 && trackIndex < audioFiles.length) {
                      const track = audioFiles[trackIndex];
                      audioPlayer.src = track.path;
                      audioPlayer.play().then(() => {
                        currentTrack = trackIndex;
                        updateTrackInfo(trackIndex);
                        playPauseButton.textContent = '⏸️'; // Update to pause emoji when playing
                      }).catch(error => {
                        console.error("Error playing the track:", error);
                        trackInfoElement.textContent = "Click to Play"; // Revert to initial message if playback fails
                      });
                    } else {
                      console.log('Track index out of bounds');
                    }
                  }
                
                  function playNextTrack() {
                    const nextTrack = (currentTrack + 1) % audioFiles.length; // Loop back to the first track if at the end
                    loadAndPlayTrack(nextTrack);
                  }
                
                  function playPreviousTrack() {
                    const prevTrack = (currentTrack - 1 + audioFiles.length) % audioFiles.length; // Loop back to the last track if at the beginning
                    loadAndPlayTrack(prevTrack);
                  }
                
                  function togglePlayPause() {
                    if (audioPlayer.paused) {
                      loadAndPlayTrack(currentTrack); // Ensure the current track is loaded and play
                    } else {
                      audioPlayer.pause();
                      playPauseButton.textContent = '▶️'; // Update to play emoji when paused
                    }
                  }
                
                  audioPlayer.addEventListener('ended', playNextTrack); // Automatically move to the next track when one ends
                
                  // Initially set to "Click to Play"
                  trackInfoElement.textContent = "Click to Play";
        </script>
  </body>
</html>
